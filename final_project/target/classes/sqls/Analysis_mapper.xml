
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jsr.project.analysis">

	<resultMap type="com.jsr.project.dtos.AnalysisDto" id="AnalysisDto">
		<result property="a_seq" column="A_SEQ" />
		<result property="a_code" column="A_CODE" />
		<result property="a_name" column="A_NAME" />
		<result property="a_img" column="A_IMG" />
		<result property="ma_seq" column="MA_SEQ" />
		<result property="id" column="ID" />
		<result property="ma_regDate" column="MA_REGDATE" />
	</resultMap>

	<resultMap type="com.jsr.project.dtos.SpendingDto" id="SpendingDto">
		<result property="p_regdate" column="P_REGDATE" />
		<result property="id" column="ID" />
		<result property="p_name" column="P_NAME" />
		<result property="p_detail" column="P_DETAIL" />
		<result property="p_location" column="P_LOCATION" />
		<result property="p_regdate" column="P_REGDATE" />
		<result property="p_money" column="P_MONEY" />
		<result property="p_some" column="P_SOME" />
		<result property="p_cashable" column="P_CASHABLE" />
		<result property="p_card" column="P_CARD" />
		<result property="p_sat" column="P_SAT" />
		<result property="p_need" column="P_NEED" />
		<result property="p_count" column="P_COUNT" />
		<result property="p_step" column="P_STEP" />
		
	</resultMap>

	<resultMap type="com.jsr.project.dtos.GoalDto" id="GoalDto">
		<result property="g_name" column="G_NAME" />
		<result property="g_money" column="G_MONEY" />
	</resultMap>

	<!-- 해당 월의 총 소비액 -->
	<select id="total_spending" parameterType="Map" resultType="Integer">
		SELECT SUM(P_MONEY) FROM SPENDING WHERE
		SUBSTR(TO_CHAR(P_REGDATE,'YYYY-MM'),1,7)=#{p_regdate} AND ID=#{id}
	</select>
	<!-- 해당 월의 총 투자액 -->
	<select id="invest_spending" parameterType="Map" resultType="Integer">
		SELECT NVL(SUM(P_MONEY),0) FROM SPENDING WHERE
		P_DETAIL='투자' AND
		SUBSTR(TO_CHAR(P_REGDATE,'YYYY-MM'),1,7)=#{p_regdate}
		AND ID=#{id}
	</select>
	<!-- 해당 월의 총 지출액 -->
	<select id="expense_spending" parameterType="Map" resultType="Integer">
		SELECT DISTINCT((SELECT SUM(P_MONEY) FROM SPENDING
		WHERE
		SUBSTR(TO_CHAR(P_REGDATE,'YYYY-MM'),1,7)=#{p_regdate} AND ID=#{id})-
		(SELECT NVL(SUM(P_MONEY),0) FROM SPENDING WHERE P_DETAIL='투자' AND
		SUBSTR(TO_CHAR(P_REGDATE,'YYYY-MM'),1,7)=#{p_regdate} AND ID=#{id}))AS
		DATA FROM SPENDING
	</select>
	<!-- 해당 월의 투자 비율 -->
	<select id="invest_ratio" parameterType="Map" resultType="Integer">
		SELECT
		DISTINCT (SELECT NVL(SUM(P_MONEY),0) FROM
		SPENDING WHERE
		P_DETAIL='투자'
		AND
		SUBSTR(TO_CHAR(P_REGDATE,'YYYY-MM'),1,7)=#{p_regdate}
		AND ID=#{id})
		/(SELECT SUM(P_MONEY) FROM SPENDING WHERE
		SUBSTR(TO_CHAR(P_REGDATE,'YYYY-MM'),1,7)=#{p_regdate} AND ID=#{id})AS
		DATA FROM SPENDING
	</select>
	<!-- 해당 월의 지출 비율 -->
	<select id="expense_ratio" parameterType="Map" resultType="Integer">
		SELECT DISTINCT(SELECT DISTINCT((SELECT SUM(P_MONEY)
		FROM SPENDING
		WHERE
		SUBSTR(TO_CHAR(P_REGDATE,'YYYY-MM'),1,7)=#{p_regdate}
		AND
		ID=#{id})-
		(SELECT NVL(SUM(P_MONEY),0) FROM SPENDING WHERE
		P_DETAIL='투자' AND
		SUBSTR(TO_CHAR(P_REGDATE,'YYYY-MM'),1,7)=#{p_regdate}
		AND
		ID=#{id}))FROM
		SPENDING)
		/(SELECT SUM(P_MONEY) FROM SPENDING WHERE
		SUBSTR(TO_CHAR(P_REGDATE,'YYYY-MM'),1,7)=#{p_regdate} AND ID=#{id})AS
		DATA FROM SPENDING
	</select>

	<!-- 총예산 -->
	<select id="total_goal" parameterType="Map" resultType="Integer">
		SELECT
		SUM(G_MONEY)AS G_MONEY FROM GOAL WHERE ID=#{id}
	</select>

	<!-- 총지출액 -->
	<select id="total_expense" parameterType="Map" resultType="Integer">
		SELECT SUM(P_MONEY) FROM SPENDING WHERE
		SUBSTR(TO_CHAR(P_REGDATE,'YYYY-MM'),1,7)=#{p_regdate} AND ID=#{id}
	</select>

	<!-- 카테고리별 예산 -->
	<select id="category_goal" parameterType="Map" resultMap="GoalDto">
		SELECT
		G_NAME,SUM(G_MONEY)AS G_MONEY FROM (SELECT
		ID,G_NAME,G_MONEY FROM GOAL
		WHERE
		ID=#{id}) GROUP BY G_NAME
	</select>

	<!-- 카테고리별 지출 -->
	<select id="category_expense" parameterType="Map" resultMap="SpendingDto">
		SELECT P_NAME,SUM(P_MONEY)AS P_MONEY FROM (SELECT
		ID,P_NAME,P_MONEY
		FROM SPENDING
		WHERE ID=#{id} AND
		SUBSTR(TO_CHAR(P_REGDATE,'YYYY-MM'),1,7)=#{p_regdate})
		GROUP BY P_NAME
	</select>

	<!-- 카테고리별 목표 달성률 -->



<!-- 뚜디니 애드먼스 쿼리  -->

SELECT SUM(P_MONEY) FROM SPENDING WHERE
		P_REGDATE BETWEEN
		ADD_MONTHS(SYSDATE,#{sMonth}) AND ADD_MONTHS(#{eDate},#{eMonth}) AND
		ID=#{id}

<!-- 유라 -->

<!-- 	spending에서 갖고와야한당  -->
	
<!-- //자기계발형 인간  -->
<select id="selfPatternScore" parameterType="String"  resultType="Integer">

</select>

<!-- //생활중심형 인간  -->
<select id="lifePatternScore" parameterType="String"  resultType="Integer">

</select>
<!-- //유흥중심형 인간 -->
<select id="playingPatternScore" parameterType="String"  resultType="Integer">

</select>
<!-- 	//쇼핑중심형 인간 -->
<select id="shoppingPatternScore" parameterType="String"  resultType="Integer">

</select>

<!-- 저번달보다 얼마나 덜썼는지?-->
<select id="compareLastMonth" parameterType="String"  resultType="Integer">

</select>


<!-- 가장 지출을 많이 한 요일은? -->
<select id="howMuchDay" parameterType="String"  resultType="Integer">

</select>


<!-- 이번달에 가장 많이 지출한 분야는?  -->
<select id="mostCategory" parameterType="String"  resultType="Integer">

</select>


<!-- 계획 이행률  -->
<select id="goalSuccess" parameterType="String"  resultType="Integer">

</select>

<!-- 수입을 얼마만큼 투자에 지출했는지 비율  -->
<select id="howMuchInvest" parameterType="String"  resultType="Integer">

</select>

<!-- 수입을 얼마만큼 저축에 지출했는지 비율  -->
<select id="howMuchSave" parameterType="String"  resultType="Integer">

</select>

<!-- 지출부분 중 필수 지출 비율  -->
<select id="essentialSpending" parameterType="String"  resultType="Integer">

</select>

<!-- 비 필수 지출비율은  -->
<select id="optionalSpending" parameterType="String"  resultType="Integer">

</select>

<!-- 평균 구매 신중도는  -->
<select id="carefulSpending" parameterType="String"  resultType="Integer">

</select>

<!-- 평균 소비 만족도는  -->

<select id="satisfySpending" parameterType="String"  resultType="Integer">

</select>





</mapper>