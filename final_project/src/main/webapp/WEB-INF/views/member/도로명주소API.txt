<%@page import="java.nio.charset.Charset"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
    <%request.setCharacterEncoding("utf-8"); %>
    <%response.setContentType("text/html; charset=utf-8"); %>
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script type="text/javascript" src="${pageContext.request.contextPath }/jq/jquery-3.2.1.js"></script>
<!-- 합쳐지고 최소화된 최신 CSS -->
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

<!-- 부가적인 테마 -->
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">

<!-- 합쳐지고 최소화된 최신 자바스크립트 -->
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript">
	
	function getAddr(){
		
		$.ajax({
			url:"http://www.juso.go.kr/addrlink/addrLinkApi.do",
			data: $("#form").serialize(),
			type:"post",
			datatype:"json",
			crossDomain:true,
			success:function(jsonStr){
				$("#list").html("");
				var errCode=jsonStr.results.common.errorCode;
				var errDesc=jsonStr.results.common.errorMassage;
				if (errCode!="0") {
					alert(errCode+"="+errDesc);
				}else{
					if (jsonStr!=null) {
						makeListJson(jsonStr);
					}
				}
			
			},error: function(xhr,status, error){
		    	alert("에러발생");
		    }
			
		});
		
	}
	
	var roadAddr="";
	var jibunAddr="";
	var zipNo="";
	
	function makeListJson(jsonStr){

		var htmlStr = "";
			htmlStr += "<table class='table table-bordered'>";
			htmlStr += "<caption>주소검색 결과</caption>";
			htmlStr += "<col width='50px;'><col width='200px;'><col width='150px;'><col width='100px;'>";
			htmlStr += "<tr class='form-inline'>";
			htmlStr += "<th class='form-group'>선택</th>";
			htmlStr += "<th class='form-group'>도로명주소</th>";
			htmlStr += "<th class='form-group'>지번주소</th>";
			htmlStr += "<th class='form-group'>우편번호</th>";
			htmlStr += "</tr>";
			
		$(jsonStr.results.juso).each(function(){
			htmlStr += "<tr class='form-inline'>";
			htmlStr += "<td class='form-group'><input type='radio' name='radioChk'></td>";
			htmlStr += "<td class='form-group' name='roadAddr'>"+this.roadAddr+"</td>";
			htmlStr += "<td class='form-group' name='jibunAddr'>"+this.jibunAddr+"</td>";
			htmlStr += "<td class='form-group' name='zipNo'>"+this.zipNo+"</td>";
			htmlStr += "</tr>";
		});
		htmlStr += "</table>";
		$("#list").html(htmlStr);
	
		$("input[name=radioChk]").click(function(){
			roadAddr=$(this).parent().next().text();
			jibunAddr=$(this).parent().next().next().text();
			zipNo=$(this).parent().next().next().next().text();
			
		});
	
	}
	
	function addrSelect(){
		opener.document.getElementsByName("zipNo")[0].value=zipNo;
		opener.document.getElementsByName("address1")[0].value=roadAddr;
		self.close();
	
	}
	
	
	
	
	
	function enterSearch(){
		var evt_code=(window.netscape)?ev.which:event,keyCode;
		if (evt_code==13) {
			event.keyCode=0;
			getAddr(); //jsonp사용시 enter검색
		}
	}
	
	function addrSel(chk){
		alert(chk);
		
	}

</script>
<title>주소검색</title>
</head>
<body>
<form id="form" method="post" style="padding: 20px 0px 0px 10px;">
	<table>
	<caption>주소 검색</caption>
		<tr class="form-inline">
			<td class="form-group">
				<input type="hidden" name="resultType" value="json">
				<input type="hidden" name="confmKey" value="U01TX0FVVEgyMDE4MDEyNTE2MjU1MjEwNzYzMDc=">
				<input type="text" name="keyword" onclick="enterSearch()" class="form-control" placeholder="군/구/동 입력">
				<input type="button" value="검색" onclick="getAddr();" class="form-control">
			</td>
		</tr>
	</table>
</form>
	<div id="list" style="padding: 20px 0px 0px 10px;"></div>

<div style="padding: 20px 0px 0px 10px;">
	<table>
		<tr>
			<td>
				<input type="button" value="선택" onclick="addrSelect()" class="btn btn-default btn-sm">
				<input type="button" value="닫기" onclick="self.close();" class="btn btn-default btn-sm">
			</td>
		</tr>
	</table>
</div>
</body>
</html>